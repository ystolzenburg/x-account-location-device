<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-Posed Options</title>
    <link rel="stylesheet" href="options.css">
</head>
<body>
    <div class="options-container">
        <!-- What's New Banner (hidden by default, shown on update) -->
        <div class="whats-new-banner" id="whats-new-banner" style="display: none;">
            <button class="whats-new-close" id="whats-new-close" aria-label="Dismiss">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
            </button>
            <div class="whats-new-content">
                <h2>üéâ What's New in X-Posed v2.4!</h2>
                <p class="whats-new-subtitle">Tag-based blocking is here!</p>
                
                <div class="whats-new-features">
                    <div class="whats-new-feature">
                        <span class="feature-icon">üè∑Ô∏è</span>
                        <div class="feature-info">
                            <strong>Tag-Based Blocking</strong>
                            <span>Block users by emojis, symbols, or text in their display names.</span>
                        </div>
                    </div>
                    <div class="whats-new-feature">
                        <span class="feature-icon">üíæ</span>
                        <div class="feature-info">
                            <strong>Export/Import Tags</strong>
                            <span>Blocked tags are now included in backup files for easy restore</span>
                        </div>
                    </div>
                </div>

                <div class="whats-new-cta">
                    <p>Tip: Click "Tags" in the Blocking section below to add your first blocked tags!</p>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header class="options-header">
            <div class="header-content">
                <img src="../icons/icon48.png" alt="X-Posed" class="header-icon">
                <div>
                    <h1>X-Posed Options</h1>
                    <span class="subtitle">Account Location & Device Info</span>
                </div>
            </div>
        </header>

        <!-- Rate Limit Status Banner -->
        <div class="rate-limit-banner" id="rate-limit-banner" style="display: none;">
            <div class="rate-limit-icon">‚ö†Ô∏è</div>
            <div class="rate-limit-content">
                <span class="rate-limit-title">Rate Limited</span>
                <span class="rate-limit-time" id="rate-limit-time"></span>
            </div>
        </div>

        <!-- Main Content -->
        <main class="options-content">
            <!-- General Settings -->
            <section class="options-section">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97 0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1 0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66z"/>
                    </svg>
                    General Settings
                </h2>

                <div class="option-row">
                    <div class="option-info">
                        <span class="option-label">Enable Extension</span>
                        <span class="option-description">Turn the extension on or off globally</span>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="opt-enabled" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="option-row">
                    <div class="option-info">
                        <span class="option-label">Debug Mode</span>
                        <span class="option-description">Show detailed logs in the console</span>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="opt-debug">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </section>

            <!-- Display Settings -->
            <section class="options-section">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                    </svg>
                    Display Settings
                </h2>

                <div class="option-row">
                    <div class="option-info">
                        <span class="option-label">Show Country Flags</span>
                        <span class="option-description">Display flag emoji next to usernames</span>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="opt-flags" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="option-row">
                    <div class="option-info">
                        <span class="option-label">Show Device Icons</span>
                        <span class="option-description">Display device type emoji (üì± üíª üåê)</span>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="opt-devices" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="option-row">
                    <div class="option-info">
                        <span class="option-label">Show VPN/Proxy Indicator</span>
                        <span class="option-description">Display üîí when location may not be accurate</span>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="opt-vpn" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="option-row">
                    <div class="option-info">
                        <span class="option-label">Show Capture Button</span>
                        <span class="option-description">Display üì∑ camera button in pill for evidence screenshots</span>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="opt-capture-button" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="option-row">
                    <div class="option-info">
                        <span class="option-label">Show VPN/Proxy Users</span>
                        <span class="option-description">Display tweets from users detected using VPN or proxy services</span>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="opt-show-vpn-users" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="option-row">
                    <div class="option-info">
                        <span class="option-label">Show Sidebar "Block Locations" Link</span>
                        <span class="option-description">Display the Block Locations link in X's sidebar navigation</span>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="opt-sidebar-link" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </section>

            <!-- Blocked Locations (Countries & Regions with Tabs) -->
            <section class="options-section">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3zm6 9.09c0 4-2.55 7.7-6 8.83-3.45-1.13-6-4.82-6-8.83V6.31l6-2.12 6 2.12v4.78z"/>
                    </svg>
                    Blocking
                </h2>

                <p class="section-description">
                    Manage which locations are blocked. Click countries or regions to toggle blocking.
                </p>

                <!-- Blocking Mode Options -->
                <div class="blocking-mode-options">
                    <div class="option-row">
                        <div class="option-info">
                            <span class="option-label">Hide blocked tweets</span>
                            <span class="option-description">Completely hide tweets from blocked locations</span>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="opt-hide-blocked" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="option-row">
                        <div class="option-info">
                            <span class="option-label">Highlight blocked tweets</span>
                            <span class="option-description">Show tweets but highlight with a red border instead of hiding</span>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="opt-highlight-blocked">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Tab Bar -->
                <div class="blocked-tabs">
                    <button class="blocked-tab active" id="tab-countries">
                        üåç Countries
                        <span class="blocked-count" id="blocked-count">0</span>
                    </button>
                    <button class="blocked-tab" id="tab-regions">
                        üó∫Ô∏è Regions
                        <span class="blocked-count" id="blocked-regions-count">0</span>
                    </button>
                    <button class="blocked-tab" id="tab-tags">
                        üè∑Ô∏è Tags
                        <span class="blocked-count" id="blocked-tags-count">0</span>
                    </button>
                </div>

                <!-- Countries Panel -->
                <div class="blocked-panel" id="panel-countries">
                    <!-- Currently blocked countries -->
                    <div class="blocked-list" id="blocked-list">
                        <p class="empty-state">No countries blocked</p>
                    </div>

                    <!-- Country search and selection -->
                    <div class="country-selector">
                        <input type="text" class="country-search" id="country-search" placeholder="Search countries to block...">
                        <div class="country-grid" id="country-grid">
                            <!-- Countries will be rendered here by JS -->
                        </div>
                    </div>

                    <div class="blocked-actions">
                        <button class="btn btn-secondary btn-small" id="btn-clear-blocked">
                            Clear All Countries
                        </button>
                    </div>
                </div>

                <!-- Regions Panel -->
                <div class="blocked-panel" id="panel-regions" style="display: none;">
                    <p class="section-hint">
                        Some X users show regional locations like "South Asia" or "Europe" instead of specific countries.
                    </p>

                    <!-- Currently blocked regions -->
                    <div class="blocked-list" id="blocked-regions-list">
                        <p class="empty-state">No regions blocked</p>
                    </div>

                    <!-- Region search and selection -->
                    <div class="country-selector">
                        <input type="text" class="country-search" id="region-search" placeholder="Search regions to block...">
                        <div class="country-grid region-grid" id="region-grid">
                            <!-- Regions will be rendered here by JS -->
                        </div>
                    </div>

                    <div class="blocked-actions">
                        <button class="btn btn-secondary btn-small" id="btn-clear-blocked-regions">
                            Clear All Regions
                        </button>
                    </div>
                </div>

                <!-- Tags Panel -->
                <div class="blocked-panel" id="panel-tags" style="display: none;">
                    <p class="section-hint">
                        Block users based on emojis, flags, or tags in their display names (e.g., üè≥Ô∏è‚Äç‚ößÔ∏è, üá∑üá∫, [BOT]).
                    </p>

                    <!-- Currently blocked tags -->
                    <div class="blocked-list" id="blocked-tags-list">
                        <p class="empty-state">No tags blocked</p>
                    </div>

                    <!-- Tag input -->
                    <div class="country-selector">
                        <div class="tag-input-row">
                            <input type="text" class="country-search" id="tag-input" placeholder="Enter emoji or tag (e.g., üá∑üá∫ or [BOT])...">
                            <button class="btn btn-primary btn-small" id="btn-add-tag">+ Add</button>
                        </div>
                    </div>

                    <div class="blocked-actions">
                        <button class="btn btn-secondary btn-small" id="btn-clear-blocked-tags">
                            Clear All Tags
                        </button>
                    </div>
                </div>
            </section>

            <!-- Community Cloud Cache -->
            <section class="options-section cloud-section">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4s1.79-4 4-4h.71C7.37 7.69 9.48 6 12 6c3.04 0 5.5 2.46 5.5 5.5v.5H19c1.66 0 3 1.34 3 3s-1.34 3-3 3z"/>
                    </svg>
                    Community Cloud Cache
                    <span class="beta-badge">OPT-IN</span>
                </h2>

                <div class="cloud-warning">
                    <svg viewBox="0 0 24 24" width="18" height="18">
                        <path fill="currentColor" d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                    </svg>
                    <div>
                        <strong>Privacy Notice:</strong> When enabled, anonymous location/device data is shared with a community server.
                        Only username mappings are shared - no personal information.
                    </div>
                </div>

                <div class="option-row">
                    <div class="option-info">
                        <span class="option-label">Enable Community Cache</span>
                        <span class="option-description">Share and receive location data with other users</span>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="opt-cloud-cache">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="cloud-status" id="cloud-status">
                    <div class="cloud-status-item">
                        <span class="status-indicator status-disabled" id="cloud-status-indicator"></span>
                        <span id="cloud-status-text">Disabled</span>
                    </div>
                </div>

                <div class="cloud-stats" id="cloud-stats" style="display: none;">
                    <div class="cloud-stat cloud-stat-highlight">
                        <span class="cloud-stat-value" id="cloud-total-entries">-</span>
                        <span class="cloud-stat-label">‚òÅÔ∏è Total in Cloud</span>
                    </div>
                    <div class="cloud-stat">
                        <span class="cloud-stat-value" id="cloud-lookups">0</span>
                        <span class="cloud-stat-label">Your Lookups</span>
                    </div>
                    <div class="cloud-stat">
                        <span class="cloud-stat-value" id="cloud-hits">0</span>
                        <span class="cloud-stat-label">Cache Hits</span>
                    </div>
                    <div class="cloud-stat">
                        <span class="cloud-stat-value" id="cloud-contributions">0</span>
                        <span class="cloud-stat-label">You Contributed</span>
                    </div>
                </div>

                <div class="cloud-actions" id="cloud-actions" style="display: none;">
                    <button class="btn btn-secondary btn-cloud-sync" id="btn-sync-to-cloud">
                        <svg viewBox="0 0 24 24" width="16" height="16">
                            <path fill="currentColor" d="M19.35 10.04C18.67 6.59 15.64 4 12 4c-1.48 0-2.85.43-4.01 1.17l1.46 1.46C10.21 6.23 11.08 6 12 6c3.04 0 5.5 2.46 5.5 5.5v.5H19c1.66 0 3 1.34 3 3 0 1.13-.64 2.11-1.56 2.62l1.45 1.45C23.16 18.16 24 16.68 24 15c0-2.64-2.05-4.78-4.65-4.96zM3 5.27l2.75 2.74C2.56 8.15 0 10.77 0 14c0 3.31 2.69 6 6 6h11.73l2 2L21 20.73 4.27 4 3 5.27zM7.73 10l8 8H6c-2.21 0-4-1.79-4-4s1.79-4 4-4h1.73z"/>
                        </svg>
                        Sync Local Cache to Cloud
                    </button>
                    <span class="sync-status" id="sync-status"></span>
                </div>

                <div class="cloud-unconfigured" id="cloud-unconfigured" style="display: none;">
                    <p>‚ö†Ô∏è Cloud cache server not configured. See the <a href="https://github.com/xaitax/x-account-location-device#community-cloud-cache" target="_blank">setup guide</a> to deploy your own server.</p>
                </div>
            </section>

            <!-- Cache Management -->
            <section class="options-section">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M21 7v12.4A2.6 2.6 0 0 1 18.4 22H5.6A2.6 2.6 0 0 1 3 19.4V4.6A2.6 2.6 0 0 1 5.6 2h9.6L21 7zm-2 1.4L15.6 4H5.6a.6.6 0 0 0-.6.6v14.8a.6.6 0 0 0 .6.6h12.8a.6.6 0 0 0 .6-.6V8.4z"/>
                    </svg>
                    Local Cache
                </h2>

                <div class="cache-info">
                    <div class="cache-stat">
                        <span class="cache-value" id="cache-size">-</span>
                        <span class="cache-label">Cached Users</span>
                    </div>
                    <div class="cache-stat">
                        <span class="cache-value" id="cache-expiry">2 weeks</span>
                        <span class="cache-label">Cache Duration</span>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" id="btn-clear-cache">
                        Clear Cache
                    </button>
                    <button class="btn btn-secondary" id="btn-export-cache">
                        Export Data
                    </button>
                    <button class="btn btn-secondary" id="btn-import-data">
                        Import Data
                    </button>
                    <input type="file" id="import-file-input" accept=".json" style="display: none;">
                </div>
                <div class="import-status" id="import-status" style="display: none;"></div>
            </section>

            <!-- Support Development -->
            <section class="options-section support-section">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                    </svg>
                    Support Development
                </h2>
                
                <div class="support-content">
                    <p>If you find X-Posed useful, please consider supporting its development. Your sponsorship helps maintain the project and add new features!</p>
                    <a href="https://ko-fi.com/M4M61EP5XL" target="_blank" rel="noopener" class="btn btn-primary support-button">
                        <svg viewBox="0 0 24 24" width="18" height="18" style="margin-right: 8px;">
                            <path fill="currentColor" d="M2.3 15.3l5.7 5.7c.4.4 1 .4 1.4 0L21.7 8.7c.4-.4.4-1 0-1.4l-5.7-5.7c-.4-.4-1-.4-1.4 0L2.3 13.9c-.4.4-.4 1 0 1.4zM19 19h-8v2h8c1.1 0 2-.9 2-2v-2h-2v2z"/>
                        </svg>
                        Buy me a coffee on Ko-fi
                    </a>
                </div>
            </section>

            <!-- About -->
            <section class="options-section">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                    </svg>
                    About
                </h2>

                <div class="about-info">
                    <p><strong>X-Posed</strong> v<span id="version">2.0.1</span></p>
                    <p class="text-muted">See where X users are located and what devices they use.</p>
                    
                    <div class="about-links">
                        <a href="https://github.com/xaitax/x-account-location-device" target="_blank" rel="noopener">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z"/>
                            </svg>
                            GitHub
                        </a>
                        <a href="https://github.com/xaitax/x-account-location-device/blob/main/PRIVACY.md" target="_blank" rel="noopener">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
                            </svg>
                            Privacy Policy
                        </a>
                        <a href="https://github.com/xaitax/x-account-location-device/issues" target="_blank" rel="noopener">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                            </svg>
                            Report Issue
                        </a>
                    </div>
                </div>
            </section>
        </main>

        <!-- Save Status -->
        <div class="save-status" id="save-status">
            <svg viewBox="0 0 24 24" width="16" height="16">
                <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
            Settings saved
        </div>
    </div>

    <script src="options.js" type="module"></script>
</body>
</html>
